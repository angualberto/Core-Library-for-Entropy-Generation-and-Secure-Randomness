CC = gcc
CFLAGS = -Wall -Wextra -std=c99 -O3 -march=native
LIBS = -lssl -lcrypto

# Detectar se jÃ¡ tem a library instalada
AGLE_LIB = $(shell pkg-config --cflags --libs libssl libcrypto 2>/dev/null || echo "-lssl -lcrypto")

TARGET = meu_app
SOURCES = main.c agle.c
OBJECTS = $(SOURCES:.c=.o)
HEADER = agle.h

# Compile options
ifdef DEBUG
    CFLAGS = -Wall -Wextra -std=c99 -g -O0 -DDEBUG
endif

ifdef RELEASE
    CFLAGS = -Wall -Wextra -std=c99 -O3 -march=native -DNDEBUG
endif

.PHONY: all clean run help

all: $(TARGET)

$(TARGET): $(OBJECTS)
	@echo "ðŸ”— Ligando: $@"
	$(CC) $(CFLAGS) -o $@ $^ $(LIBS)
	@echo "âœ… Compilado: ./$@"

%.o: %.c $(HEADER)
	@echo "ðŸ“¦ Compilando: $<"
	$(CC) $(CFLAGS) -c $<

run: $(TARGET)
	@echo "ðŸš€ Executando .../$(TARGET)..."
	./$(TARGET)

debug:
	@echo "ðŸ› Compilando com debug..."
	$(MAKE) DEBUG=1 clean all

release:
	@echo "âš¡ Compilando versÃ£o release..."
	$(MAKE) RELEASE=1 clean all
	strip $(TARGET)

clean:
	@echo "ðŸ—‘ï¸  Limpando..."
	rm -f *.o $(TARGET)
	@echo "âœ… Limpo"

help:
	@echo "Comandos disponÃ­veis:"
	@echo "  make           - Compilar (padrÃ£o)"
	@echo "  make run       - Compilar e executar"
	@echo "  make debug     - Compilar com debug (-g)"
	@echo "  make release   - VersÃ£o otimizada"
	@echo "  make clean     - Remover binÃ¡rios"
	@echo "  make help      - Este menu"
